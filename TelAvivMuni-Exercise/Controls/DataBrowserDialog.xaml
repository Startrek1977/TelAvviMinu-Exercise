<Window x:Class="TelAvivMuni_Exercise.Controls.DataBrowserDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:TelAvivMuni_Exercise.ViewModels"
        xmlns:behaviors="clr-namespace:TelAvivMuni_Exercise.Infrastructure.Behaviors"
        Title="Select Product"
        Width="520"
        Height="400"
        ResizeMode="CanResize"
        ShowInTaskbar="False"
        WindowStartupLocation="Manual"
        Background="White"
        behaviors:DialogCloseBehavior.DialogResult="{Binding DialogResult}"
        behaviors:AutoFocusSearchBehavior.TargetTextBox="{Binding ElementName=SearchTextBox}"
        behaviors:AutoFocusSearchBehavior.EscapeCommand="{Binding CancelCommand}">

  <Grid Margin="0">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>

    <!--  Search Box  -->
    <Border Grid.Row="0"
            Margin="12,12,12,8"
            BorderBrush="#E0E0E0"
            BorderThickness="1"
            CornerRadius="2">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="Auto" />
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>
        <Viewbox Grid.Column="0"
                 Width="18"
                 Height="18"
                 Margin="10,0,5,0"
                 VerticalAlignment="Center">
          <Canvas Width="24" Height="24">
            <Path Data="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                  Fill="#757575" />
          </Canvas>
        </Viewbox>
        <TextBox x:Name="SearchTextBox"
                 Grid.Column="1"
                 Padding="0,8"
                 VerticalContentAlignment="Center"
                 Background="Transparent"
                 BorderThickness="0"
                 FontSize="13"
                 behaviors:EscapeClearBehavior.IsEnabled="True"
                 Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" />
        <Button Grid.Column="2"
                Width="20"
                Height="20"
                Margin="5,0,8,0"
                Background="Transparent"
                BorderThickness="0"
                Command="{Binding ClearSearchCommand}"
                Content="&#x2715;"
                Cursor="Hand"
                FontSize="12"
                Foreground="#9E9E9E">
          <Button.Style>
            <Style TargetType="Button">
              <Setter Property="Visibility" Value="Collapsed" />
              <Setter Property="Template">
                <Setter.Value>
                  <ControlTemplate TargetType="Button">
                    <Border Background="{TemplateBinding Background}"
                            CornerRadius="10">
                      <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                    </Border>
                    <ControlTemplate.Triggers>
                      <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="#F0F0F0" />
                      </Trigger>
                    </ControlTemplate.Triggers>
                  </ControlTemplate>
                </Setter.Value>
              </Setter>
              <Style.Triggers>
                <DataTrigger Binding="{Binding HasSearchText}" Value="True">
                  <Setter Property="Visibility" Value="Visible" />
                </DataTrigger>
              </Style.Triggers>
            </Style>
          </Button.Style>
        </Button>
      </Grid>
    </Border>

    <!--  DataGrid  -->
    <DataGrid x:Name="ProductsDataGrid"
              Grid.Row="1"
              Margin="12,0,12,8"
              AutoGenerateColumns="True"
              AutoGeneratingColumn="DataGrid_AutoGeneratingColumn"
              Background="White"
              BorderBrush="#E0E0E0"
              BorderThickness="1"
              CanUserAddRows="False"
              CanUserDeleteRows="False"
              CanUserReorderColumns="False"
              CanUserResizeRows="False"
              GridLinesVisibility="Horizontal"
              HeadersVisibility="Column"
              HorizontalGridLinesBrush="#F5F5F5"
              IsReadOnly="True"
              ItemsSource="{Binding FilteredItems}"
              SelectedItem="{Binding SelectedItem, Mode=TwoWay}"
              RowBackground="White"
              RowHeight="36"
              ScrollViewer.HorizontalScrollBarVisibility="Auto"
              ScrollViewer.VerticalScrollBarVisibility="Auto"
              SelectionMode="Single"
              behaviors:DataGridEnterBehavior.EnterCommand="{Binding OkCommand}"
              ColumnHeaderStyle="{StaticResource DataGridColumnHeaderStyle}"
              CellStyle="{StaticResource DataGridCellStyle}"
              RowStyle="{StaticResource DataGridRowStyle}">
    </DataGrid>

    <!--  Items Count  -->
    <TextBlock Grid.Row="2"
               Margin="12,0,12,8"
               FontSize="11"
               Foreground="#757575"
               Text="{Binding ItemsCount, StringFormat='{}{0} items'}" />

    <!--  Buttons  -->
    <StackPanel Grid.Row="3"
                Margin="12,0,12,12"
                HorizontalAlignment="Right"
                Orientation="Horizontal">
      <Button Width="80"
              Height="32"
              Margin="0,0,8,0"
              Command="{Binding CancelCommand}"
              Content="Cancel"
              Style="{StaticResource GrayButtonStyle}" />
      <Button Width="80"
              Height="32"
              Command="{Binding OkCommand}"
              Content="OK"
              IsDefault="True"
              Style="{StaticResource BlueButtonStyle}" />
    </StackPanel>
  </Grid>
</Window>
